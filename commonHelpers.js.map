{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import axios from \"axios\";\nimport iziToast from \"izitoast\";\nimport \"izitoast/dist/css/iziToast.min.css\";\nimport SimpleLightbox from \"simplelightbox\";\nimport \"simplelightbox/dist/simple-lightbox.min.css\";\n\nconst gallery = document.querySelector('.js-gallery');\nconst input = document.querySelector('.input-string');\nconst form = document.querySelector('.input-wrap');\nconst photoLoader = document.getElementById('photo-loader');\nconst loadMore = document.querySelector('.button-more');\nconst morePhotoLoader = document.getElementById('more-photo-loader');\n\nlet inputValue = '';\nconst onInput = (e) => { inputValue = e.target.value; };\ninput.addEventListener('input', onInput);\n\nconst lightbox = new SimpleLightbox('.gallery-image-lightbox', {\n    captions: true, captionPosition: 'bottom', captionsData: 'alt', close: true, loop: true, enableKeyboard: true, slideSpeed: 400, \n});\n\nconst api = axios.create({\n    baseURL: 'https://pixabay.com/api/', \n    params: {\n        key: '41857217-9df28d1efe56a78287de94859',\n        image_type: 'photo',\n        orientation: 'horizontal',\n        safesearch: true,\n    }\n})\n\nconst getPhoto = async (params) => {\n    try {\n        const response = await api.get('', { params });\n        \n        return response.data;\n    } catch (error) {\n        iziToast.error({ title: 'Error', message: 'Error fetching or processing photos' });\n    }\n};\n\nconst fetchPhotos = (q) => {\n    let page = 1; \n    let isLastPage = false;\n    const per_page = 40;\n\n    return async () => {\n        try {\n            const { hits, total } = await getPhoto({ q, page, per_page });\n            \n            if (total < per_page) {\n                iziToast.info({ title: 'Error', message: 'Sorry, there are no images matching your search query. Please try again!' });\n                input.value = '';\n                photoLoader.classList.remove('loader');\n                loadMore.style.display = 'none';\n                return;\n            } \n            if (isLastPage) return iziToast.info({ message: \"We're sorry, but you've reached the end of search results.\" });\n\n\n            if (page >= Math.floor(total / per_page)) isLastPage = true;\n            page += 1;\n            return hits;\n        } catch (error) {\n            iziToast.error({ title: 'Error', message: 'Error fetching or processing photos' });\n        } \n    }  \n}\n\nconst renderPhoto = async (uploadPhoto) => {\n    const photo = await uploadPhoto();\n    const imagePromises = photo.map(img => loadImage(img.webformatURL));\n\n    await Promise.all(imagePromises);\n    renderMarkup(photo);\n    loadMore.style.display = 'block';\n\n    const firstGalleryItem = gallery.querySelector('.gallery-item');\n    if (firstGalleryItem) {\n        const cardHeight = firstGalleryItem.getBoundingClientRect().height;\n\n        window.scrollBy({\n            top: 2 * cardHeight,\n            behavior: 'smooth',\n        });\n    }\n}\n\nlet fetchPhotosFunc = null;\n\nconst submitPhotos = async (e) => {\n    e.preventDefault();\n    \n    if (fetchPhotosFunc !== null) loadMore.removeEventListener('click', fetchPhotosFunc);\n    gallery.innerHTML = '';\n    loadMore.style.display = 'none';\n\n    if (inputValue.trim() === '') return iziToast.error({ title: 'Error', message: 'Please, type a search query' });\n    \n    fetchPhotosFunc = fetchPhotos(inputValue);\n\n    // render photo\n    try {\n        photoLoader.classList.add('loader');\n        await renderPhoto(fetchPhotosFunc);\n    } catch (error) {\n        iziToast.error({ title: 'Error', message: 'Error fetching or processing photos' });\n    } finally {\n        photoLoader.classList.remove('loader');\n        morePhotoLoader.classList.remove('loader');\n        loadMore.classList.remove('is-hiden');\n    }\n    // load more\n    loadMore.addEventListener('click', async () => {\n        try {\n            morePhotoLoader.classList.add('loader');\n            await renderPhoto(fetchPhotosFunc);\n        } catch (error) {\n            iziToast.error({ title: 'Error', message: 'Error fetching or processing photos' });\n        }finally {\n            photoLoader.classList.remove('loader');\n            morePhotoLoader.classList.remove('loader');\n            loadMore.classList.remove('is-hiden');\n        }\n    });\n\n    input.value = '';\n    lightbox.refresh();\n}\nform.addEventListener('submit', submitPhotos);\n\n\nfunction renderMarkup (img = []) {\n    const marcup = img.reduce((html, {largeImageURL, webformatURL, tags, likes, views, comments, downloads }) => html + `\n            <li class=\"gallery-item\">\n                <a href=\"${largeImageURL}\" class=\"gallery-image-lightbox\">\n                    <img class=\"gallery-image\"\n                        src=\"${webformatURL}\"\n                        alt=\"${tags}\"\n                    />\n                </a>\n                <div class=\"photo-info\">\n                    <p class=\"item-info\"><b>Likes</b><br>${likes}</p>\n                    <p class=\"item-info\"><b>Views</b><br>${views}</p>\n                    <p class=\"item-info\"><b>Comments</b><br>${comments}</p>\n                    <p class=\"item-info\"><b>Dowloads</b><br>${downloads}</p>\n                </div>\n            </li>`, '');\n    gallery.insertAdjacentHTML('beforeend', marcup);\n}\n\nfunction loadImage(url) {\n    return new Promise((resolve, reject) => {\n        const image = new Image();\n        image.onload = resolve;\n        image.onerror = reject;\n        image.src = url;\n    });\n}"],"names":["gallery","input","form","photoLoader","loadMore","morePhotoLoader","inputValue","onInput","e","lightbox","SimpleLightbox","api","axios","getPhoto","params","iziToast","fetchPhotos","q","page","isLastPage","per_page","hits","total","renderPhoto","uploadPhoto","photo","imagePromises","img","loadImage","renderMarkup","firstGalleryItem","cardHeight","fetchPhotosFunc","submitPhotos","marcup","html","largeImageURL","webformatURL","tags","likes","views","comments","downloads","url","resolve","reject","image"],"mappings":"owBAMA,MAAMA,EAAU,SAAS,cAAc,aAAa,EAC9CC,EAAQ,SAAS,cAAc,eAAe,EAC9CC,EAAO,SAAS,cAAc,aAAa,EAC3CC,EAAc,SAAS,eAAe,cAAc,EACpDC,EAAW,SAAS,cAAc,cAAc,EAChDC,EAAkB,SAAS,eAAe,mBAAmB,EAEnE,IAAIC,EAAa,GACjB,MAAMC,EAAWC,GAAM,CAAEF,EAAaE,EAAE,OAAO,OAC/CP,EAAM,iBAAiB,QAASM,CAAO,EAEvC,MAAME,EAAW,IAAIC,EAAe,0BAA2B,CAC3D,SAAU,GAAM,gBAAiB,SAAU,aAAc,MAAO,MAAO,GAAM,KAAM,GAAM,eAAgB,GAAM,WAAY,GAC/H,CAAC,EAEKC,EAAMC,EAAM,OAAO,CACrB,QAAS,2BACT,OAAQ,CACJ,IAAK,qCACL,WAAY,QACZ,YAAa,aACb,WAAY,EACf,CACL,CAAC,EAEKC,EAAW,MAAOC,GAAW,CAC/B,GAAI,CAGA,OAFiB,MAAMH,EAAI,IAAI,GAAI,CAAE,OAAAG,CAAM,CAAE,GAE7B,IACnB,MAAe,CACZC,EAAS,MAAM,CAAE,MAAO,QAAS,QAAS,qCAAqC,CAAE,CACpF,CACL,EAEMC,EAAeC,GAAM,CACvB,IAAIC,EAAO,EACPC,EAAa,GACjB,MAAMC,EAAW,GAEjB,MAAO,UAAY,CACf,GAAI,CACA,KAAM,CAAE,KAAAC,EAAM,MAAAC,CAAK,EAAK,MAAMT,EAAS,CAAE,EAAAI,EAAG,KAAAC,EAAM,SAAAE,CAAQ,CAAE,EAE5D,GAAIE,EAAQF,EAAU,CAClBL,EAAS,KAAK,CAAE,MAAO,QAAS,QAAS,0EAA0E,CAAE,EACrHd,EAAM,MAAQ,GACdE,EAAY,UAAU,OAAO,QAAQ,EACrCC,EAAS,MAAM,QAAU,OACzB,MACH,CACD,OAAIe,EAAmBJ,EAAS,KAAK,CAAE,QAAS,4DAA4D,CAAE,GAG1GG,GAAQ,KAAK,MAAMI,EAAQF,CAAQ,IAAGD,EAAa,IACvDD,GAAQ,EACDG,EACV,MAAe,CACZN,EAAS,MAAM,CAAE,MAAO,QAAS,QAAS,qCAAqC,CAAE,CACpF,CACJ,CACL,EAEMQ,EAAc,MAAOC,GAAgB,CACvC,MAAMC,EAAQ,MAAMD,IACdE,EAAgBD,EAAM,IAAIE,GAAOC,EAAUD,EAAI,YAAY,CAAC,EAElE,MAAM,QAAQ,IAAID,CAAa,EAC/BG,EAAaJ,CAAK,EAClBrB,EAAS,MAAM,QAAU,QAEzB,MAAM0B,EAAmB9B,EAAQ,cAAc,eAAe,EAC9D,GAAI8B,EAAkB,CAClB,MAAMC,EAAaD,EAAiB,sBAAqB,EAAG,OAE5D,OAAO,SAAS,CACZ,IAAK,EAAIC,EACT,SAAU,QACtB,CAAS,CACJ,CACL,EAEA,IAAIC,EAAkB,KAEtB,MAAMC,EAAe,MAAOzB,GAAM,CAO9B,GANAA,EAAE,eAAc,EAEZwB,IAAoB,MAAM5B,EAAS,oBAAoB,QAAS4B,CAAe,EACnFhC,EAAQ,UAAY,GACpBI,EAAS,MAAM,QAAU,OAErBE,EAAW,SAAW,GAAI,OAAOS,EAAS,MAAM,CAAE,MAAO,QAAS,QAAS,6BAA+B,CAAA,EAE9GiB,EAAkBhB,EAAYV,CAAU,EAGxC,GAAI,CACAH,EAAY,UAAU,IAAI,QAAQ,EAClC,MAAMoB,EAAYS,CAAe,CACpC,MAAe,CACZjB,EAAS,MAAM,CAAE,MAAO,QAAS,QAAS,qCAAqC,CAAE,CACzF,QAAc,CACNZ,EAAY,UAAU,OAAO,QAAQ,EACrCE,EAAgB,UAAU,OAAO,QAAQ,EACzCD,EAAS,UAAU,OAAO,UAAU,CACvC,CAEDA,EAAS,iBAAiB,QAAS,SAAY,CAC3C,GAAI,CACAC,EAAgB,UAAU,IAAI,QAAQ,EACtC,MAAMkB,EAAYS,CAAe,CACpC,MAAe,CACZjB,EAAS,MAAM,CAAE,MAAO,QAAS,QAAS,qCAAqC,CAAE,CAC7F,QAAS,CACGZ,EAAY,UAAU,OAAO,QAAQ,EACrCE,EAAgB,UAAU,OAAO,QAAQ,EACzCD,EAAS,UAAU,OAAO,UAAU,CACvC,CACT,CAAK,EAEDH,EAAM,MAAQ,GACdQ,EAAS,QAAO,CACpB,EACAP,EAAK,iBAAiB,SAAU+B,CAAY,EAG5C,SAASJ,EAAcF,EAAM,GAAI,CAC7B,MAAMO,EAASP,EAAI,OAAO,CAACQ,EAAM,CAAC,cAAAC,EAAe,aAAAC,EAAc,KAAAC,EAAM,MAAAC,EAAO,MAAAC,EAAO,SAAAC,EAAU,UAAAC,CAAW,IAAKP,EAAO;AAAA;AAAA,2BAE7FC,CAAa;AAAA;AAAA,+BAETC,CAAY;AAAA,+BACZC,CAAI;AAAA;AAAA;AAAA;AAAA,2DAIwBC,CAAK;AAAA,2DACLC,CAAK;AAAA,8DACFC,CAAQ;AAAA,8DACRC,CAAS;AAAA;AAAA,mBAEnD,EAAE,EAClB1C,EAAQ,mBAAmB,YAAakC,CAAM,CAClD,CAEA,SAASN,EAAUe,EAAK,CACpB,OAAO,IAAI,QAAQ,CAACC,EAASC,IAAW,CACpC,MAAMC,EAAQ,IAAI,MAClBA,EAAM,OAASF,EACfE,EAAM,QAAUD,EAChBC,EAAM,IAAMH,CACpB,CAAK,CACL"}