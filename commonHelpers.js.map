{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import axios from \"axios\";\nimport iziToast from \"izitoast\";\nimport \"izitoast/dist/css/iziToast.min.css\";\nimport SimpleLightbox from \"simplelightbox\";\nimport \"simplelightbox/dist/simple-lightbox.min.css\";\n\nconst gallery = document.querySelector('.js-gallery');\nconst input = document.querySelector('.input-string');\nconst form = document.querySelector('.input-wrap');\nconst photoLoader = document.getElementById('photo-loader');\nconst loadMore = document.querySelector('.button-more');\nconst morePhotoLoader = document.getElementById('more-photo-loader');\n\nlet inputValue = '';\nconst handleInput = (e) => { inputValue = e.target.value; };\ninput.addEventListener('input', handleInput);\n\nconst lightbox = new SimpleLightbox('.gallery-image-lightbox', {\n    captions: true, captionPosition: 'bottom', captionsData: 'alt', close: true, loop: true, enableKeyboard: true, slideSpeed: 400, \n});\n\n\nconst api = axios.create({\n    baseURL: 'https://pixabay.com/api/', \n    params: {\n        key: '41857217-9df28d1efe56a78287de94859',\n        image_type: 'photo',\n        orientation: 'horizontal',\n        safesearch: true,\n    }\n})\n\nconst getPhotos = async (params) => {\n    try {\n        const response = await api.get('', { params });\n        \n        return response.data;\n    } catch (error) {\n        iziToast.error({ title: 'Error', message: 'Error fetching or processing photos' });\n    }\n};\n\nconst initializePhotoFetching = (q) => {\n    const state = {\n        page: 1,\n        isLastPage: false,\n        per_page: 40,\n    };\n\n    return async () => {\n        try {\n            const { hits, total } = await getPhotos({ q, page: state.page, per_page: state.per_page });\n            \n\n            if (total === 0) {\n                iziToast.info({ title: 'Error', message: 'Sorry, there are no images matching your search query. Please try again!' });\n                input.value = '';\n                photoLoader.classList.remove('loader');\n                loadMore.classList.add('is-hidden');\n                return;\n            }\n\n            state.isLastPage = state.page >= Math.ceil(total / state.per_page);\n            state.page += 1;\n\n            if (state.isLastPage) {\n                iziToast.info({ message: \"We're sorry, but you've reached the end of search results.\" });\n                loadMore.style.display = 'none';\n                loadMore.removeEventListener('click', morePhotoLoadClick);\n            } else {\n                loadMore.style.display = 'block';\n            }\n\n            return hits;\n        } catch (error) {\n            iziToast.error({ title: 'Error', message: 'Error fetching or processing photos' });\n        }\n    };\n};\n\nconst renderPhoto = async (uploadPhoto) => {\n    const photo = await uploadPhoto();\n    const imagePromises = photo.map(img => loadImage(img.webformatURL));\n\n    await Promise.all(imagePromises);\n    \n    renderMarkup(photo);\n\n    const firstGalleryItem = gallery.querySelector('.gallery-item');\n    if (firstGalleryItem) {\n        const cardHeight = firstGalleryItem.getBoundingClientRect().height;\n\n        window.scrollBy({\n            top: 2 * cardHeight,\n            behavior: 'smooth',\n        });\n    }\n    \n};\n\nlet fetchPhotosFunc = null;\n\nconst submitPhotosForm = async (e) => {\n    e.preventDefault();\n\n    if (fetchPhotosFunc !== null) {\n        loadMore.removeEventListener('click', morePhotoLoadClick);\n        fetchPhotosFunc = null;\n    }\n\n    gallery.innerHTML = '';\n    loadMore.style.display = 'none';\n\n    if (inputValue.trim() === '') {\n        iziToast.error({ title: 'Error', message: 'Please, type a search query' })\n        return\n    }\n\n    const newFetchPhotosFunc = initializePhotoFetching(inputValue);\n    fetchPhotosFunc = newFetchPhotosFunc;\n\n    // render photo\n    try {\n        photoLoader.classList.add('loader');\n        await renderPhoto(fetchPhotosFunc);\n    } catch (error) {\n        iziToast.error({ title: 'Error', message: 'Error fetching or processing photos' });\n    } finally {\n        photoLoader.classList.remove('loader');\n        morePhotoLoader.classList.remove('loader');\n        loadMore.classList.remove('is-hidden');\n\n        loadMore.addEventListener('click', morePhotoLoadClick);\n        \n    }\n    // load more\n    loadMore.addEventListener('click', morePhotoLoadClick);\n\n    input.value = '';\n    lightbox.refresh();\n};\nloadMore.classList.add('is-hidden');\nform.addEventListener('submit', submitPhotosForm);\n\nasync function morePhotoLoadClick() {\n    try {\n        morePhotoLoader.classList.add('loader');\n        await renderPhoto(fetchPhotosFunc);\n    } catch (error) {\n        iziToast.error({ title: 'Error', message: 'Error fetching or processing photos' });\n    } finally {\n        photoLoader.classList.remove('loader');\n        morePhotoLoader.classList.remove('loader');\n        loadMore.classList.remove('is-hidden');\n    }\n    if (fetchPhotosFunc && fetchPhotosFunc.isLastPage) {\n            console.log('Reached before hiding button'); \n            loadMore.classList.add('is-hidden');\n        } else {\n            loadMore.classList.remove('is-hidden');\n        }\n}\n\n\nfunction renderMarkup (img = []) {\n    const markup = img.reduce((html, {largeImageURL, webformatURL, tags, likes, views, comments, downloads }) => html + `\n            <li class=\"gallery-item\">\n                <a href=\"${largeImageURL}\" class=\"gallery-image-lightbox\">\n                    <img class=\"gallery-image\"\n                        src=\"${webformatURL}\"\n                        alt=\"${tags}\"\n                    />\n                </a>\n                <div class=\"photo-info\">\n                    <p class=\"item-info\"><b>Likes</b><br>${likes}</p>\n                    <p class=\"item-info\"><b>Views</b><br>${views}</p>\n                    <p class=\"item-info\"><b>Comments</b><br>${comments}</p>\n                    <p class=\"item-info\"><b>Dowloads</b><br>${downloads}</p>\n                </div>\n            </li>`, '');\n    gallery.insertAdjacentHTML('beforeend', markup);\n};\n\nfunction loadImage(url) {\n    return new Promise((resolve, reject) => {\n        const image = new Image();\n        image.onload = resolve;\n        image.onerror = reject;\n        image.src = url;\n    });\n};"],"names":["gallery","input","form","photoLoader","loadMore","morePhotoLoader","inputValue","handleInput","e","lightbox","SimpleLightbox","api","axios","getPhotos","params","iziToast","initializePhotoFetching","q","state","hits","total","morePhotoLoadClick","renderPhoto","uploadPhoto","photo","imagePromises","img","loadImage","renderMarkup","firstGalleryItem","cardHeight","fetchPhotosFunc","submitPhotosForm","markup","html","largeImageURL","webformatURL","tags","likes","views","comments","downloads","url","resolve","reject","image"],"mappings":"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"}